---
title: "Untitled"
output: html_document
---

## Conections between targets and metabolites

```{R}
load("data/targets_metabolites_fgfr3.RData")
library(dplyr)

targets_to_metabolites_fgfr3$FGFR3 <- unique(targets_to_metabolites_fgfr3$FGFR3)

edges_target_met <- data.frame(
                            Source = rep(names(targets_to_metabolites_fgfr3), lengths(targets_to_metabolites_fgfr3)),
                            Target = unlist(targets_to_metabolites_fgfr3))

# Save information about gene and metabolite nodes
nodes <- data.frame(
  name = unique(c(edges_target_met$Source, edges_target_met$Target)),
  type = c(rep("Gene", length(unique(edges_target_met$Source))), rep("Metabolite", length(unique(edges_target_met$Target))))
)
```

## Conections between species and metabolites

```{R}
library(stringr)
load("data/gutmgene/gutmgene1_beforemerging.RData")

gutmgene_species <- gutmgene1 %>%
                        mutate(Microbe_Species = word(Gut_Microbe_Name, 1))

edges_species_met <- data.frame(
                            Source = gutmgene_species$Microbe_Species,
                            Target = gutmgene_species$Metabolite_Name)
```

## Connections between species and MDD

```{R}
# install.packages("jsonlite")
library(jsonlite)
library(stringr)
library(dplyr)

disbiome.JSON <- fromJSON("data/network/species_mdd.json")
disbiome_df <- as.data.frame(disbiome.JSON)
disbiome_df <- disbiome_df %>%
                        mutate(species = word(organism_name, 1))

edges_species_mdd <- data.frame(
                            Source = unique(disbiome_df$species),
                            Target = rep("MDD", length(unique(disbiome_df$species))))

# Save information about species and MDD nodes
nodes <- rbind(nodes, data.frame(
                          name = edges_species_mdd$Source,
                          type = rep("Species", length(unique(edges_species_mdd$Source)))
              ))
nodes <- rbind(nodes, data.frame(
                            name = "MDD",
                            type = "Disorder"
                        ))
```

## Conections between MDD and KEGG, and MDD and Reactome

```{R}
library(stringr)

mdd_kegg_react <- read.table("data/network/mdd_kegg_react.csv", sep = ",", header = TRUE)
mdd_kegg <- mdd_kegg_react[str_detect(mdd_kegg_react$Pathway.ID, "KEGG"),]
mdd_react <- mdd_kegg_react[str_detect(mdd_kegg_react$Pathway.ID, "REACT"),]

edges_mdd_kegg <- data.frame(
                        Source = rep("MDD", nrow(mdd_kegg)),
                        Target = mdd_kegg$Pathway)
edges_mdd_react <- data.frame(
                        Source = rep("MDD", nrow(mdd_react)),
                        Target = mdd_react$Pathway)
edges_mdd_pathways <- rbind(edges_mdd_kegg, edges_mdd_react)
```

## Conections between genes and KEGG

```{R}
fgfr3_kegg <- read.table("data/network/fgfr3/fgfr3_kegg.txt", sep = "\t", header = F)

edges_target_kegg <- data.frame(
                            Source = rep("FGFR3", nrow(fgfr3_kegg)),
                            Target = fgfr3_kegg$V2)

# Save information about KEGG pathway nodes
nodes <- rbind(nodes, data.frame(
                        name = unique(edges_target_kegg$Target),
                        type = rep("Pathway", length(unique(edges_target_kegg$Target)))
              ))
```

## Conections between genes and Reactome

```{R}
fgfr3_react <- read.csv("data/network/fgfr3/fgfr3_react.csv", sep = ",", header = TRUE)

edges_target_react <- data.frame(
                            Source = rep("FGFR3", nrow(fgfr3_react)),
                            Target = fgfr3_react$Pathway.name)

# Save information about reactome pathway nodes
nodes <- rbind(nodes, data.frame(
                        name = unique(edges_target_react$Target),
                        type = rep("Pathway", length(unique(edges_target_react$Target)))
              ))
```

```{R}
# Save information about MDD pathway nodes
edges_mdd_pathways = edges_mdd_pathways[edges_mdd_pathways$Target %in% c(edges_target_react$Target, edges_target_kegg$Target), ]
nodes <- rbind(nodes, data.frame(
                        name = unique(edges_mdd_pathways$Target),
                        type = rep("Pathway", length(unique(edges_mdd_pathways$Target)))
              ))
```


## Get all the edges and node type, clean and save

```{R}
edges <- rbind(edges_target_met, edges_target_react, edges_target_kegg, edges_mdd_pathways, edges_species_mdd, edges_species_met)
edges_clean <- distinct(edges)

nodes_clean <- distinct(nodes)
order <- c("Metabolite", "Pathway", "Species", "Gene", "Disorder")
nodes_clean <- nodes_clean %>%
  mutate(layer = as.numeric(factor(type, levels = order)))

# Save
write.table(edges_clean, file = "data/network/fgfr3/cytoscape_edges.tsv", row.names=FALSE, sep="\t")
write.table(nodes_clean, file = "data/network/fgfr3/cytoscape_nodes.tsv", row.names=FALSE, sep="\t")
```
