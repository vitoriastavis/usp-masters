all_unique_genes  <- list()
all_analyses <- list()
# List all subdirectories inside the main directory
subdirs <- list.dirs(twas_path, recursive = FALSE)
# Loop through each subdirectory
for (subdir in subdirs) {
analyses_genes <- list()
unique_genes <- c()
# Find the CSV file in the subdirectory
csv_files <- list.files(subdir, pattern = "\\.csv$", full.names = TRUE)
# If there's at least one CSV file, read it
if (length(csv_files) > 0) {
csv_path <- csv_files[1]  # Assuming there's only one CSV per folder
# Extract the file name without extension
file_name <- tools::file_path_sans_ext(basename(csv_path))
data <- read.csv(csv_path, header = TRUE)
for (col in colnames(data)){
genes <- unique(data[[col]])
analyses_genes[[col]] <- genes
unique_genes <- unique(c(unique_genes, genes))
}
all_analyses[[file_name]] <- analyses_genes
all_unique_genes[[file_name]] <- unique_genes
} else {
warning(paste("No CSV file found in", subdir))
}
}
twas_path <- "data/twas/"
all_unique_genes  <- list()
all_analyses <- list()
# List all subdirectories inside the main directory
subdirs <- list.dirs(twas_path, recursive = FALSE)
# Loop through each subdirectory
for (subdir in subdirs) {
analyses_genes <- list()
unique_genes <- c()
# Find the CSV file in the subdirectory
csv_files <- list.files(subdir, pattern = "\\.csv$", full.names = TRUE)
# If there's at least one CSV file, read it
if (length(csv_files) > 0) {
csv_path <- csv_files[1]  # Assuming there's only one CSV per folder
# Extract the file name without extension
file_name <- tools::file_path_sans_ext(basename(csv_path))
data <- read.csv(csv_path, header = TRUE)
for (col in colnames(data)){
genes <- unique(data[[col]])
analyses_genes[[col]] <- genes
unique_genes <- unique(c(unique_genes, genes))
}
all_analyses[[file_name]] <- analyses_genes
all_unique_genes[[file_name]] <- unique_genes
} else {
warning(paste("No CSV file found in", subdir))
}
}
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
intersections <- list()
analyses_genes <- unname(unlist(all_analyses[[file_name]]))
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
for (source in names(target_sources)){
targets <- target_sources[[source]]
analyses_intersections[[paste0(file_name, '_', source)]] <- intersect(analyses_genes, targets)
unique_intersections[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets)
}
all_intersections[[file_name]] <- analyses_intersections
all_unique_genes_intersect[[file_name]] <- unique_intersections
}
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
analyses_intersect <- list()
unique_intersect <- list()
analyses_genes <- unname(unlist(all_analyses[[file_name]]))
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
for (source in names(target_sources)){
targets <- target_sources[[source]]
analyses_intersect[[paste0(file_name, '_', source)]] <- intersect(analyses_genes, targets)
unique_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets)
}
all_intersections[[file_name]] <- analyses_intersect
all_unique_genes_intersect[[file_name]] <- unique_intersect
}
for (file_name in names(all_genes)){
intersections <- list()
genes <- unname(unlist(all_genes[[file_name]]))
for (source in names(target_sources)){
targets <- target_sources[[source]]
intersections[[paste0(file_name, '_', source)]] <- intersect(genes, targets)
}
all_intersections[[file_name]] <- intersections
}
View(all_unique_genes_intersect)
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
analyses_intersect <- list()
unique_intersect <- list()
analyses_genes <- unname(unlist(all_analyses[[file_name]]))
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
analyses_intersect[[paste0(file_name, '_', source)]] <- intersect(analyses_genes, targets_intersection)
unique_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets_intersection)
# for (source in names(target_sources)){
#   targets <- target_sources[[source]]
#
#   analyses_intersect[[paste0(file_name, '_', source)]] <- intersect(analyses_genes, targets)
#   unique_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets)
#
# }
all_intersections[[file_name]] <- analyses_intersect
all_unique_genes_intersect[[file_name]] <- unique_intersect
}
for (file_name in names(all_genes)){
intersections <- list()
genes <- unname(unlist(all_genes[[file_name]]))
for (source in names(target_sources)){
targets <- target_sources[[source]]
intersections[[paste0(file_name, '_', source)]] <- intersect(genes, targets)
}
all_intersections[[file_name]] <- intersections
}
View(all_analyses)
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
analyses_intersect <- list()
unique_intersect <- list()
analyses_genes <- all_analyses[[file_name]]
for (analysis in names(analyses_genes)){
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
analyses_intersect[[paste0(file_name, '_', analysis)]] <- intersect(analyses_genes, targets_intersection)
}
all_intersections[[file_name]] <- analyses_intersect
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
unique_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets_intersection)
all_unique_genes_intersect[[file_name]] <- unique_intersect
}
for (file_name in names(all_genes)){
intersections <- list()
genes <- unname(unlist(all_genes[[file_name]]))
for (source in names(target_sources)){
targets <- target_sources[[source]]
intersections[[paste0(file_name, '_', source)]] <- intersect(genes, targets)
}
all_intersections[[file_name]] <- intersections
}
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
analyses_intersect <- list()
unique_intersect <- list()
analyses_genes <- all_analyses[[file_name]]
for (analysis in names(analyses_genes)){
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
analyses_intersect[[paste0(file_name, '_', analysis)]] <- intersect(analyses_genes, targets_intersection)
}
all_analyses_intersect[[file_name]] <- analyses_intersect
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
unique_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets_intersection)
all_unique_genes_intersect[[file_name]] <- unique_intersect
}
for (file_name in names(all_genes)){
intersections <- list()
genes <- unname(unlist(all_genes[[file_name]]))
for (source in names(target_sources)){
targets <- target_sources[[source]]
intersections[[paste0(file_name, '_', source)]] <- intersect(genes, targets)
}
all_intersections[[file_name]] <- intersections
}
View(all_analyses_intersect)
for (file_name in names(all_analyses)){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(analyses_genes)
}
for (file_name in names(all_analyses)){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(names(analyses_genes))
}
for (file_name in names(all_analyses)){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(names(analyses_genes))
for (analysis in names(analyses_genes)){
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(head(analyses_genes))
}
}
for (file_name in names(all_analyses)){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(names(analyses_genes))
for (analysis in names(analyses_genes)){
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(head(analyses_genes), 5)
}
}
for (file_name in names(all_analyses)){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(names(analyses_genes))
# for (analysis in names(analyses_genes)){
#   analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
#   print(head(analyses_genes), 5)
# }
}
for (file_name in names(all_analyses[1:3])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(names(analyses_genes))
# for (analysis in names(analyses_genes)){
#   analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
#   print(head(analyses_genes), 5)
# }
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(names(analyses_genes))
# for (analysis in names(analyses_genes)){
#   analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
#   print(head(analyses_genes), 5)
# }
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
# analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
# print(head(analyses_genes), 5)
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
# print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(head(analyses_genes, 5))
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
# print(analysis)
analysis_genes <- unname(unlist(analyses_genes$analysis))
print(head(analyses_genes, 5))
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
# analysis_genes <- unname(unlist(analyses_genes$analysis))
# print(head(analyses_genes, 5))
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
# print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(analyses_genes[1:3])
}
}
for (file_name in names(all_analyses[1:2])) {
analyses_genes <- all_analyses[[file_name]]
for (analysis in names(analyses_genes)) {
cat("\nFile:", file_name, "| Analysis:", analysis, "\n")
# Extract and flatten the gene list
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
# Print a preview of the genes
print(head(analysis_genes, 5))  # Show only first 5 genes for clarity
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(head(analysis_genes, 5))
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(intersect(analyses_genes, targets_intersection))
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(head(analysis_genes, 5))
# print(intersect(analyses_genes, targets_intersection))
}
}
targets_intersection
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(head(analysis_genes, 12))
# print(intersect(analyses_genes, targets_intersection))
}
}
View(all_analyses)
twas_path <- "data/twas/"
all_unique_genes  <- list()
all_analyses <- list()
# List all subdirectories inside the main directory
subdirs <- list.dirs(twas_path, recursive = FALSE)
# Loop through each subdirectory
for (subdir in subdirs) {
analyses_genes <- list()
unique_genes <- c()
# Find the CSV file in the subdirectory
csv_files <- list.files(subdir, pattern = "\\.csv$", full.names = TRUE)
# If there's at least one CSV file, read it
if (length(csv_files) > 0) {
csv_path <- csv_files[1]  # Assuming there's only one CSV per folder
# Extract the file name without extension
file_name <- tools::file_path_sans_ext(basename(csv_path))
data <- read.csv(csv_path, header = TRUE)
for (col in colnames(data)){
genes <- unique(data[[col]])
analyses_genes[[col]] <- genes
unique_genes <- unique(c(unique_genes, genes))
}
all_analyses[[file_name]] <- analyses_genes
all_unique_genes[[file_name]] <- unique_genes
} else {
warning(paste("No CSV file found in", subdir))
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
print(head(analysis_genes, 12))
# print(intersect(analyses_genes, targets_intersection))
}
}
for (file_name in names(all_analyses[1:2])){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
# print(head(analysis_genes, 12))
print(intersect(analyses_genes, targets_intersection))
}
}
for (file_name in names(all_analyses)){
# analyses_intersect <- list()
# unique_intersect <- list()
#
analyses_genes <- all_analyses[[file_name]]
# print(names(analyses_genes))
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
# print(head(analysis_genes, 12))
print(intersect(analyses_genes, targets_intersection))
}
}
intersect(analyses_genes, targets_intersection)
analyses_genes
for (file_name in names(all_analyses)){
analyses_genes <- all_analyses[[file_name]]
for (analysis in names(analyses_genes)){
print(analysis)
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
# print(head(analysis_genes, 12))
print(intersect(analysis_genes, targets_intersection))
}
}
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
analyses_intersect <- list()
unique_intersect <- list()
analyses_genes <- all_analyses[[file_name]]
for (analysis in names(analyses_genes)){
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
analyses_intersect[[paste0(file_name, '_', analysis)]] <- intersect(analysis_genes, targets_intersection)
}
all_analyses_intersect[[file_name]] <- analyses_intersect
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
unique_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets_intersection)
all_unique_genes_intersect[[file_name]] <- unique_intersect
}
View(all_analyses_intersect)
View(all_unique_genes_intersect)
table(all_unique_genes_intersect)
save(all_analyses_intersect, all_unique_genes_intersect, file = "data/twas/intersections.RData")
all_analyses_intersect$adams2025$adams2025_Final
all_analyses_intersect$adams2025$adams2025_PsyOPS
all_analyses_intersect$meng2024$meng2024_TWAS
```{r message=FALSE, warning=FALSE}
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
analyses_intersect <- list()
unique_intersect <- list()
analyses_genes <- all_analyses[[file_name]]
for (analysis in names(analyses_genes)){
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
analyses_intersect[[paste0(file_name, '_', analysis)]] <- intersect(analysis_genes, targets_intersection)
}
all_analyses_intersect[[file_name]] <- analyses_intersect
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
all_unique_genes_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets_intersection)
}
pairwise_intersections <- combn(all_unique_genes_intersect, 2, function(x) intersect(x[[1]], x[[2]]), simplify = FALSE)
View(pairwise_intersections)
all_intersections <- Reduce(intersect, all_unique_genes_intersect)
all_intersections
all_unique_genes_intersect$levey2021_intersection <- NULL
pairwise_intersections <- combn(all_unique_genes_intersect, 2, function(x) intersect(x[[1]], x[[2]]), simplify = FALSE)
all_intersections <- Reduce(intersect, all_unique_genes_intersect)
all_intersections
three_intersections <- combn(all_unique_genes_intersect, 3, function(x) intersect(x[[1]], x[[2]]), simplify = FALSE)
View(three_intersections)
three_intersections <- combn(all_unique_genes_intersect, 3, function(x) intersect(x[[1]], x[[2]]), x[[3]]), simplify = FALSE)
three_intersections <- combn(all_unique_genes_intersect, 3, function(x) intersect(x[[1]], x[[2]], x[[3]]), simplify = FALSE)
threewise_intersections <- combn(all_unique_genes_intersect, 3, function(x) Reduce(intersect, x), simplify = FALSE)
View(threewise_intersections)
all_analyses_intersect <- list()
all_unique_genes_intersect <- list()
for (file_name in names(all_analyses)){
analyses_intersect <- list()
unique_intersect <- list()
analyses_genes <- all_analyses[[file_name]]
for (analysis in names(analyses_genes)){
analysis_genes <- unname(unlist(analyses_genes[[analysis]]))
analyses_intersect[[paste0(file_name, '_', analysis)]] <- intersect(analysis_genes, targets_intersection)
}
all_analyses_intersect[[file_name]] <- analyses_intersect
unique_genes <- unname(unlist(all_unique_genes[[file_name]]))
all_unique_genes_intersect[[paste0(file_name, '_', source)]] <- intersect(unique_genes, targets_intersection)
}
# all_unique_genes_intersect$levey2021_intersection <- NULL
pairwise_intersections <- combn(all_unique_genes_intersect, 2, function(x) intersect(x[[1]], x[[2]]), simplify = FALSE)
threewise_intersections <- combn(all_unique_genes_intersect, 3, function(x) Reduce(intersect, x), simplify = FALSE)
fourwise_intersections <- combn(all_unique_genes_intersect, 4, function(x) Reduce(intersect, x), simplify = FALSE)
fourwise_intersections
View(fourwise_intersections)
